import{b as P,f as W,o as S,s as v,t as F}from"./index-C5Q1Okh6.js";import{$ as H,a as R,P as U,b as q,T as K,p as L}from"./MilkdownEditor-BItiUuSt.js";var O=e=>{throw TypeError(e)},x=(e,t,s)=>t.has(e)||O("Cannot "+s),i=(e,t,s)=>(x(e,t,"read from private field"),t.get(e)),a=(e,t,s)=>t.has(e)?O("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),n=(e,t,s,o)=>(x(e,t,"write to private field"),t.set(e,s),s),N=(e,t,s)=>(x(e,t,"access private method"),s),w,k,c,p,g,d,m,f,y,$,C;class G{constructor(t){a(this,$),a(this,w),a(this,k),a(this,c),a(this,p),a(this,g),a(this,d),a(this,m),a(this,f),a(this,y),n(this,d,!1),this.onShow=()=>{},this.onHide=()=>{},n(this,y,(s,o)=>{const{state:h,composing:r}=s,{selection:u,doc:M}=h,{ranges:_}=u,T=Math.min(..._.map(l=>l.$from.pos)),E=Math.max(..._.map(l=>l.$to.pos)),I=o&&o.doc.eq(M)&&o.selection.eq(u);if(i(this,d)||((i(this,g)??s.dom.parentElement??document.body).appendChild(this.element),n(this,d,!0)),r||I)return;if(!i(this,k).call(this,s,o)){this.hide();return}P({getBoundingClientRect:()=>L(s,T,E)},this.element,{placement:i(this,p).placement??"top",middleware:[W(),S(i(this,m)),v(i(this,f)),...i(this,c)]}).then(({x:l,y:B})=>{Object.assign(this.element.style,{left:`${l}px`,top:`${B}px`})}).catch(console.error),this.show()}),this.update=(s,o)=>{F(i(this,y),i(this,w))(s,o)},this.destroy=()=>{},this.show=s=>{this.element.dataset.show="true",s&&P(s,this.element,{placement:"top",middleware:[W(),S(i(this,m)),v(i(this,f)),...i(this,c)],...i(this,p)}).then(({x:o,y:h})=>{Object.assign(this.element.style,{left:`${o}px`,top:`${h}px`})}).catch(console.error),this.onShow()},this.hide=()=>{this.element.dataset.show!=="false"&&(this.element.dataset.show="false",this.onHide())},this.element=t.content,n(this,w,t.debounce??200),n(this,k,t.shouldShow??N(this,$,C)),n(this,m,t.offset),n(this,f,t.shift),n(this,c,t.middleware??[]),n(this,p,t.floatingUIOptions??{}),n(this,g,t.root),this.element.dataset.show="false"}}w=new WeakMap;k=new WeakMap;c=new WeakMap;p=new WeakMap;g=new WeakMap;d=new WeakMap;m=new WeakMap;f=new WeakMap;y=new WeakMap;$=new WeakSet;C=function(e){const{doc:t,selection:s}=e.state,{empty:o,from:h,to:r}=s,u=!t.textBetween(h,r).length&&e.state.selection instanceof K,M=this.element.contains(document.activeElement),_=!e.hasFocus()&&!M,T=!e.editable;return!(_||o||u||T)};function b(e){const t=H({},`${e}_TOOLTIP_SPEC`),s=R(h=>{const r=h.get(t.key);return new U({key:new q(`${e}_TOOLTIP`),...r})}),o=[t,s];return o.key=t.key,o.pluginKey=s.key,t.meta={package:"@milkdown/plugin-tooltip",displayName:`Ctx<tooltipSpec>|${e}`},s.meta={package:"@milkdown/plugin-tooltip",displayName:`Prose<tooltip>|${e}`},o}export{G as T,b as t};
